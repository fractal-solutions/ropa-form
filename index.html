<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Records of Processing Activities</title>
    <style>

        /* Animation for appearing */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Animation for disappearing */
        @keyframes fadeOutDown {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        body {
            font-family: "Lucida Grande", "Lucida Sans Unicode", sans-serif;
            background: linear-gradient(to bottom, #3b5998, #192f60);
            color: #ffffff;
            text-align: center;
            padding: 20px;
            zoom: 0.65;
        }

        .container {
            max-width: 600px;
            min-height: 700px;
            margin: 0 auto;
            margin-top: -20px;
            margin-left: 300px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            position: relative;
            background: linear-gradient(135deg, #2c3e50, #34495e); /* Gradient background */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Soft shadow for depth */
            font-size: 18px;
            justify-self: end;
        }

        .tableContainer {
            display: none;
            margin: 0 auto;
            margin-top: -20px;
            margin-left: 300px;
            padding: 0px;
            padding-top: 10px;
            background: linear-gradient(135deg, #2c3e50, #34495e); /* Gradient background */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Soft shadow for depth */
            border-radius: 15px;
            position: relative;
        }

        h2 {
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-segment {
            opacity: 0;
            animation: fadeInUp 0.5s ease-out forwards;
            display: none;
        }

        .form-segment.active {
            display: block;
        }

        .input-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 1em;
            color: #ecf0f1;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 90%;
            padding: 10px;
            font-size: 1em;
            border-radius: 10px;
            border: 1px solid #7f8c8d;
            background: #34495e;
            color: #ecf0f1;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        }

        .input-group textarea {
            height: 130px;
            resize: vertical;
        }

        .input-group textarea ::-webkit-scrollbar {
            display: none; /* Hide scrollbar for Chrome, Safari, and Opera */
        }

        .checkbox-item {
            display: flex;
            align-items: center; /* Aligns checkbox and label vertically */
        }

        .checkbox-item input[type="checkbox"] {
            transform: scale(0.8); /* Adjust the scale value as needed */
            margin-right: 10px; /* Optional: add some space between checkbox and label */
            width: auto; /* Ensure that the checkbox doesn't get affected by parent width */
        }

        .slider-container {
            position: relative;
            width: max-content;
            justify-content: center;
            text-align: left;
        }

        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            background: transparent;
            margin: 10px 0;
            padding-left: 30%;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #ddd;
            cursor: pointer;
            border-radius: 50%;
            padding-left: 30%;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #ddd;
            cursor: pointer;
            border-radius: 50%;
            padding-left: 10%;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            padding-left: 30%;
            width: 100%;
        }

        .slider-container::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 6px;
            top: 50%;
            left: 30%;
            background: linear-gradient(to right, red, orange, green);
            z-index: -1;
            border-radius: 3px;
        }

        .warning::placeholder{
            color:#ff0000;
            
        }

        .warning::disabled {
            background-color: #5b0000d3;
        }




        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            position: absolute;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center; /* Center the buttons horizontally */
            gap: 200px; 
            bottom: 10px;
        }

        .navigation button {
            padding: 10px 20px;
            font-size: 1em;
            color: #ffffff;
            background: linear-gradient(to bottom, #2980b9, #1c598a);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .navigation button:hover {
            background: linear-gradient(to bottom, #1c598a, #143d63); /* Darker on hover */
            transform: scale(1.05); /* Slightly enlarge on hover */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Larger shadow on hover */
        }

        .navigation button:active {
            transform: scale(0.95); /* Slightly shrink on click */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Smaller shadow on click */
        }

        .navigation button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }



        /* Container for the progress bar */
        .progress-bar {
            width: 100%;
            background: #ecf0f1;
            border-radius: 20px; /* Rounded corners */
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Shadow effect for depth */
        }

        /* Fill progress */
        .progress {
            height: 10px; /* Slightly thicker */
            background: linear-gradient(45deg, #3498db, #2ecc71); /* Gradient background */
            border-radius: 20px; /* Match border radius with container */
            transition: width 0.5s ease-in-out; /* Smooth transition for width change */
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2); /* Inner shadow for depth */
        }

        .wrapper {
            display: flex;
            min-height: 100vh; 
        }



        .sidebar {
            width: 250px; /* Slightly wider for more space */
            height: 100vh;
            background: linear-gradient(135deg, #2c3e50, #34495e); /* Gradient background */
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Soft shadow for depth */
            border-radius: 8px; /* Rounded corners */
            flex-shrink: 0;
            transition: all 0.3s ease; /* Smooth transition for hover effects */
            overflow-y: auto;

            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: fixed;
            font-size: 16px;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
        }

        .sidebar ul li a {
            color: #ecf0f1;
            text-decoration: none;
            font-size: 1.2em;
            display: block;
            padding: 10px;
            border-radius: 5px;
            background: linear-gradient(to bottom, #2980b9, #1c598a);
            text-align: center;
            transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .sidebar ul li a:hover {
            background: linear-gradient(to bottom, #1c598a, #143d63); /* Darker on hover */
            transform: scale(1.05); /* Slightly enlarge on hover */
            transform: translateX(5px); /* Slide effect on hover */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Larger shadow on hover */
        }

        .sidebar ul li a:active {
            transform: scale(0.95); /* Slightly shrink on click */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Smaller shadow on click */
            font-weight: bold;
        }

        /* Footer styling */
        .sidebar-footer {
            margin-top: auto; /* Pushes the footer to the bottom */
            text-align: center;
            padding: 10px;
        }

        /* Engraved text styling */
        .sidebar .engraved-text {
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.99em;
            color: #151515;
            text-align: center;
            margin: 10px 0;
            position: absolute;
            bottom: 20px;
            width: 80%;
            text-shadow: 
                1px 1px 2px rgba(139, 139, 139, 0.1),
                -1px -1px 2px rgba(139, 139, 139, 0.1),
                1px -1px 2px rgba(149, 149, 149, 0.1),
                -1px 1px 2px rgba(139, 139, 139, 0.1);
        }


        .content {
            flex-grow: 1;
            padding: 20px;
        }



        

        thead {
            background: #34495e;
        }

        tr:hover td {
            background: #3b5998;
        }

        .hide-column {
            display: none;
        }

       /* General Table Styling */

        table {
            width: 100%;
            border-collapse: collapse;
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            font-size: 18px;
        }

        table th {
            font-weight: bold;
            text-transform: uppercase;
        }

        table th, table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #2c2c2c;
        }

        /* Row Hover Effect */
        table tr:hover {
            background-color: #2c3e50; /* Slightly lighter for row hover */
        }

        /* Badge Styling */
        .sensitive-badge {
            background-color: #e74c3c; /* Red for sensitive data */
            color: white;
            padding: 5px 8px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            margin: 2px;
        }

        .non-sensitive-badge {
            background-color: #2ecc71; /* Green for non-sensitive data */
            color: white;
            padding: 5px 8px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            margin: 2px;
        }

        .neutral-badge {
            background-color: orange; /* Green for non-sensitive data */
            color: white;
            padding: 5px 8px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            margin: 2px;
        }

        .no-badge {
            background-color: gray; /* Green for non-sensitive data */
            color: white;
            padding: 5px 8px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            margin: 2px;
        }

        /* Info Cell Styling */
        .info-cell div, .parties-cell div, .controller-processor-cell div, .protection-cell div {
            margin-bottom: 6px;
        }



        .info-cell .data {
            font-weight: normal;
            color: #ecf0f1; /* Light color for data */
        }

        /* Other Cell Styling */
        .info-cell, .parties-cell, .controller-processor-cell, .protection-cell {
            font-size: 18px;
        }

        .info-cell .legend, .parties-cell .legend, .controller-processor-cell .legend, .protection-cell .legend {
            font-weight: bold;
            color: #3498db; /* Blue for distinction */
        }

        .info-cell .data, .parties-cell .data, .controller-processor-cell .data, .protection-cell .data {
            font-weight: normal;
            color: #ecf0f1; /* Light color for data */
        }


        /* For smaller screens, stack items vertically */
        @media (max-width: 768px) {
            td div:nth-child(2) {
                grid-template-columns: 1fr;
            }
        }


        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black background with opacity */
            font-size: 14px;
        }

        .modal ::-webkit-scrollbar {
            display: none; /* Hide scrollbar for Chrome, Safari, and Opera */
        }

        .modal-content {
            background: linear-gradient(135deg, #2c3e50, #34495e); /* Gradient background */
            margin: 3% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            border-radius: 8px; /* Rounded corners */
            max-height: 80%;
            overflow-y: auto;
        }

        .modal button {
            padding: 10px 20px;
            font-size: 1em;
            color: #ffffff;
            background: linear-gradient(to bottom, #2980b9, #1c598a);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .modal button:hover {
            background: linear-gradient(to bottom, #1c598a, #143d63); /* Darker on hover */
            transform: scale(1.05); /* Slightly enlarge on hover */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Larger shadow on hover */
        }

        .modal button:active {
            transform: scale(0.95); /* Slightly shrink on click */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Smaller shadow on click */
        }

        .modal button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        .modal label {
            display: block;
            margin-bottom: 5px;
            font-size: 1em;
            color: #ecf0f1;
        }

        /* Style for the fieldsets */
        .modal-content fieldset {
            display: inline-block; /* Make fieldsets inline */
            width: 40%; /* Width of each fieldset */
            margin-right: 2%; /* Space between fieldsets */
            margin-bottom: 20px; /* Space below each fieldset */
            padding: 15px; /* Padding inside each fieldset */
            border: 2px solid #ecf0f1; /* Border color and thickness */
            border-radius: 10px; /* Rounded corners */
            box-sizing: border-box; /* Include padding and border in element's width and height */
            vertical-align: top; /* Align the top of each fieldset */
        }

        /* Ensure all fieldsets have the same height */
        .modal-content fieldset {
            height: auto; /* Default height */
            min-height: 200px; /* Minimum height for consistency */
        }

        /* Make sure all fieldsets in the same row have the same height */
        .modal-content fieldset:nth-child(2n-1) {
            clear: left; /* Clear floats for alignment */
        }

        /* Remove margin-right for the last fieldset in the row */
        .modal-content fieldset:nth-child(2n) {
            margin-right: 0;
        }

        /* Adjust the modal body for better alignment */
        #modalBody {
            display: flex;
            flex-wrap: wrap; /* Wrap fieldsets to the next row */
            gap: 10px; /* Space between fieldsets */
            justify-content: space-between; /* Space them out evenly */
        }

        /* Style for the legend */
        .modal-content legend {
            font-weight: bold; /* Make the legend text bold */
            padding: 0 10px; /* Add padding to the legend text */
            color: #2980b9; /* Legend text color */
        }

        .modal input,
        .modal select,
        .modal textarea {
            width: 90%;
            padding: 10px;
            font-size: 1em;
            border-radius: 10px;
            border: 1px solid #7f8c8d;
            background: #34495e;
            color: #ecf0f1;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        }

        /* Modal Footer */
        .modal-footer {
            text-align: center;
            margin-top: 20px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Stakeholder tabs style */
        .stakeholder-tabs,
        .tabs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            display: flex;
        }

        .stakeholder-tabs .tab-link, 
        .tabs .tab-link {
            background-color: #2c3e50;
            color: #ecf0f1;
            border: 1px solid #34495e;
            border-bottom: none;
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            flex: 1; /* Equal width for each tab */
            text-align: center;
            font-size: 1.1em;
            border-radius: 8px 8px 0 0; /* Rounded top corners */
        }

        .stakeholder-tabs .tab-link:hover, 
        .tabs .tab-link:hover {
            background-color: #1c598a;
        }

        .stakeholder-tabs .tab-link.active,
        .tabs .tab-link.active {
            background-color: #ecf0f1;
            color: #2c3e50;
            border-color: #ecf0f1 #ecf0f1 #ffffff;
        }

        /* Style the tab content */
        .tab-content,
        .categories-tab-content {
            display: none;
            padding: 20px;
            border: 0.5px solid #ecf0f1;
            border-radius: 0 8px 8px 8px;
            /* background-color: #ffffff; */
        }

        .tab-content.active,
        .categories-tab-content.active {
            display: block;
        }

        /**/
        /* Accordion Styles */
        .accordion {
            color: white;
            cursor: pointer;
            padding: 4px;
            width: 90%;
            text-align: left;
            border: none;
            outline: none;
            transition: background-color 0.3s ease;
            margin-bottom: 5px;
            font-weight: normal;
            border-radius: 4px;
        }

        .accordion:hover {
            /* background-color: #3498db; */
        }

        /* Accordion Button Styles */
        .modal .accordion-button {
            width: 100%;
            background: linear-gradient(135deg, #2c3e50, #2c3e50);
            border: none;
            color: inherit;
            cursor: pointer;
            text-align: center;
            padding: 12px 0;
        }

       
        .modal .accordion-button {
            font-size: 16px;
            color: #fff;
            margin: 0px;
        }

        .accordion-button:hover {
            /* background-color: #3498db; */
        }

        .accordion-content {
            padding: 10px;
            /* background: linear-gradient(135deg, #2c3e50, #2c3e50);  */
            display: none;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 4px 4px;
        }

        .accordion-content label {
            display: block;
            margin-bottom: 5px;
            font-weight: normal;
        }

        .accordion-content input[type="text"] {
            width: 90%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        /* Active Accordion Content */
        .accordion-content.active {
            display: block;
        }




        


    </style>
</head>
<body>
    <div class="wrapper">
        <nav class="sidebar">
            <ul>
                <li><a href="#" onclick="showForm()">New Record</a></li>
                <li><a href="#" onclick="showTable()">RoPA Entries</a></li>
            </ul>
            <div class="sidebar-footer">
                <p class="engraved-text">Fractal ™</p>
            </div>
        </nav>
        <main class="content">
            <!-- ROPA FORM-->
            <div class="container">
                <h2>Record of Processing Activities</h2>
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
                <form id="ropaForm">
                    
                    <!-- Segment 1 -->
                    <div class="form-segment active">
                        <div class="input-group">
                            <label for="processingActivity">Processing Activity</label>
                            <textarea id="processingActivity" name="processingActivity" placeholder="A processing activity is any action or series of actions performed on data, especially personal data.  This definition is meant to be broad and encompass pretty much anything you can do with data. Because this is a ROPA, Assess each processing activity separately..." required></textarea>
                        </div>
                        <div class="input-group">
                            <label for="sourceReceivedFrom">Source Received from</label>
                            <input type="text" id="sourceReceivedFrom" name="sourceReceivedFrom" placeholder="Where did you source this data from?" required>
                        </div>
                        <div class="input-group">
                            <label for="data">Data</label>
                            <input type="text" id="data" name="data" placeholder="What data are you dealing with?" required>
                        </div>
                    </div>

                    <!-- Segment 2 -->
                    <div class="form-segment">
                        <div class="input-group">
                            <label for="purpose">Purpose</label>
                            <textarea id="purpose" name="purpose" placeholder="Why are you dealing with this data? E.g we need to provided medical care or we need to process employment applications" required></textarea>
                        </div>
                        <div class="input-group">
                            <label for="sharedWith">Third-Party (Shared with)</label>
                            <input type="text" id="sharedWith" name="sharedWith" placeholder="Who are you sharing this information with?" required>
                        </div>
                        <div class="input-group">
                            <label for="dataSubject">Data Subject</label>
                            <input type="text" id="dataSubject" name="dataSubject" placeholder="Whose data is this?" required>
                        </div>
                    </div>

                    <!-- Segment 3 -->
                    <div class="form-segment">
                        <div class="input-group">
                            <label for="typeOfRecord">Type Of Record</label>
                            <input type="text" id="typeOfRecord" name="typeOfRecord" placeholder="What type of record is it?" required>
                        </div>
                        <div class="input-group">
                            <label for="dataClassification">Data Classification</label>
                            <input type="text" id="dataClassification" name="dataClassification" placeholder="What is the classification of this data?" required>
                        </div>
                        <div class="input-group">
                            <label for="sensitiveData">Sensitive Data</label>
                            <select id="sensitiveData" name="sensitiveData" required>
                                <option value="" disabled selected>Select an option</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                    </div>

                    <!-- Segment 4 -->
                    <div class="form-segment">
                        <div class="input-group">
                            <label for="gchControllerProcessor">GCH is controller or processor?</label>
                            <select id="gchControllerProcessor" name="gchControllerProcessor" required>
                                <option value="" disabled selected>Select an option</option>
                                <option value="controller">Controller</option>
                                <option value="processor">Processor</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="thirdPartyControllerProcessor">Third Party is controller or processor?</label>
                            <select id="thirdPartyControllerProcessor" name="thirdPartyControllerProcessor" required>
                                <option value="" disabled selected>Select an option</option>
                                <option value="controller">Controller</option>
                                <option value="processor">Processor</option>
                                <option value="none">None</option>
                            </select>
                        </div>
                        
                        
                    </div>

                    <!-- Segment 5 -->
                    <div class="form-segment">
                        <div class="input-group">
                            <label for="basisOfProcessing">Basis of Processing</label>
                            <select id="basisOfProcessing" name="basisOfProcessing" required>
                                <option value="" disabled selected>Select an option</option>
                                <option value="consent">Consent</option>
                                <option value="contract">Contract</option>
                                <option value="legal-obligation">Legal obligation compliance</option>
                                <option value="vital-interests">Protection of vital interests</option>
                                <option value="public-interest-task">Task in public interest</option>
                                <option value="public-authority-task">Task by public authority</option>
                                <option value="public-function">Public function</option>
                                <option value="legitimate-interests">Legitimate interests</option>
                                <option value="research">Research, statistics, journalism, literature</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="justificationOfBasis">Justification of basis</label>
                            <textarea id="justificationOfBasis" name="justificationOfBasis" placeholder="Why did you select the basis - what is proof of the basis?" required></textarea>
                        </div>
                        <div class="input-group">
                            <label for="legitimateInterest">legitimate Interest</label>
                            <textarea id="legitimateInterest" name="legitimateInterest" placeholder="If the basis selected is legitimate interest, document in detail." required></textarea>
                        </div>
                    </div>


                    <!-- Segment X-->
                    

                    <!-- Segment 6 -->
                    <div class="form-segment">
                        
                        <div class="input-group">
                            <label for="impactOfProcessing">Impact of processing</label>
                            <textarea id="impactOfProcessing" name="impactOfProcessing" placeholder="Have we done DPIA?" required></textarea>
                        </div>

                        <div class="input-group">
                            <label for="automatedDecisionMaking">Existence of automated decision-making, including profiling (if applicable)</label>
                            <select id="automatedDecisionMaking" name="automatedDecisionMaking" required>
                                <option value="" disabled selected>Select an option</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>

                    </div>

                    <!-- Segment 7 -->
                    <div class="form-segment">
                        <div class="input-group">
                            <label for="transfer">Transfer</label>
                            <select id="transfer" name="transfer" required>
                                <option value="" disabled selected>Is there transfer of data?</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="transferMechanism">Transfer Mechanism</label>
                            <input type="text" id="transferMechanism" name="transferMechanism" placeholder="How is data transfer undertaken?" required></textarea>
                        </div>
                        <div class="input-group">
                            <label for="storage">Storage</label>
                            <input type="text" id="storage" name="storage" placeholder="Where will the data be stored?" required></textarea>
                        </div>
                        <div class="input-group">
                            <label for="storageDuration">Storage Duration</label>
                            <input type="text" id="storageDuration" name="storageDuration" placeholder="How long will the data be stored?" required></textarea>
                        </div>


                        <div class="slider-container">
                            <label for="storageSecurity">Storage Security</label>
                            <input type="range" id="storageSecurity" name="storageSecurity" min="0" max="2" step="1" value="1">
                            <div class="slider-labels" id="storageSecurityLabel">
                                <span>Unsafe</span>
                                <span>Safe</span>
                                <span>Protected</span>
                            </div>
                        </div>
                    </div>

                    <!-- SEGMENT 8-->
                    <div class="form-segment">
                        <div class="input-group">
                            <label for="transfer">YOU HAVE NOT COMPLETED REQUIRED VALUES FOR THE ROPA</label>
                            <input class="warning" type="text" placeholder="Go back through the form and fill relevant data!!!" readonly required></textarea>
                            <div style="text-align: center; height: 100px; line-height: 100px; display: flex; justify-content: center; align-items: center; color: red; font-size: 200px; padding-top: 80px">
                                &#9888;
                            </div>
                        </div>
                    </div>


                    <div class="navigation">
                        <button type="button" id="prevBtn" onclick="changeSegment(-1)" disabled>Previous</button>
                        <button type="button" id="nextBtn" onclick="changeSegment(1)">Next</button>
                    </div>
                </form>
            </div>

            <!-- Table to display submitted entries -->
            <div class="tableContainer">
                <h2>Submitted Entries</h2>
                <table id="entriesTable">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Info</th>
                            <th>Parties</th>
                            <th>Controller/Processor</th>
                            <th>Protection</th>
            
                            <th class="hide-column">Justification of Basis</th>
                            <th class="hide-column">Legitimate Interest</th>
                            <th class="hide-column">Impact of Processing</th>
                            <th class="hide-column">Automated Decision-Making</th>
                            <th class="hide-column">Transfer</th>
                            <th class="hide-column">Transfer Mechanism</th>
                           
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Entries will be dynamically added here -->
                    </tbody>
                </table>
            </div>

            <!-- Modal -->
            <div id="ropaModal" class="modal">
                <div class="modal-content" id="modalBody">
                    <span class="close">&times;</span>
                    <h2>ROPA Entry Details</h2>
                    
                </div>
            </div>
            
            <template id="ropaModalTemplate">
                <form id="modalRopaForm">
                    <!-- Processing Operation Section -->
                    <fieldset>
                        <legend>Processing Operation</legend>
                        <label for="processingDescription">Description of the processing operation:</label>
                        <textarea id="processingDescription" name="processingDescription"></textarea>
        
                        <label for="processingName">Name of the processing operation:</label>
                        <input type="text" id="processingName" name="processingName">
        
                        <label for="processingRef">ROPA Processing List REF:</label>
                        <input type="text" id="processingRef" name="processingRef">
        
                        <label for="creationDate">Date of creation of the processing:</label>
                        <input type="date" id="creationDate" name="creationDate">
        
                        <label for="updateDate">Update of the processing:</label>
                        <input type="date" id="updateDate" name="updateDate">
                    </fieldset>
        
                    <!-- Stakeholders Section -->
                    <fieldset>
                        <legend>Stakeholders</legend>
                    
                        <!-- Tabbed interface for stakeholders -->
                        <div class="stakeholder-tabs">
                            <div type="button" class="tab-link active" onclick="openStakeholderTab(event, 'controller')">Controller</div>
                            <div type="button" class="tab-link" onclick="openStakeholderTab(event, 'dpo')">Data Protection Officer (DPO)</div>
                            <div type="button" class="tab-link" onclick="openStakeholderTab(event, 'representative')">Representative</div>
                        </div>
                    
                        <!-- Stakeholder content sections -->
                        <div id="controller" class="tab-content active">
                            <label for="controllerName">Controller Name:</label>
                            <input type="text" id="controllerName" name="controllerName">
                    
                            <label for="controllerAddress">Controller Address:</label>
                            <input type="text" id="controllerAddress" name="controllerAddress">
                    
                            <label for="controllerPhone">Phone number:</label>
                            <input type="text" id="controllerPhone" name="controllerPhone">
                    
                            <label for="controllerEmail">Email address:</label>
                            <input type="email" id="controllerEmail" name="controllerEmail">
                        </div>
                    
                        <div id="dpo" class="tab-content">
                            <label for="dpoName">DPO Name:</label>
                            <input type="text" id="dpoName" name="dpoName">
                    
                            <label for="dpoAddress">DPO Address:</label>
                            <input type="text" id="dpoAddress" name="dpoAddress">
                    
                            <label for="dpoPhone">Phone number:</label>
                            <input type="text" id="dpoPhone" name="dpoPhone">
                    
                            <label for="dpoEmail">Email address:</label>
                            <input type="email" id="dpoEmail" name="dpoEmail">
                        </div>
                    
                        <div id="representative" class="tab-content">
                            <label for="repName">Representative Name:</label>
                            <input type="text" id="repName" name="repName">
                    
                            <label for="repAddress">Representative Address:</label>
                            <input type="text" id="repAddress" name="repAddress">
                    
                            <label for="repPhone">Phone number:</label>
                            <input type="text" id="repPhone" name="repPhone">
                    
                            <label for="repEmail">Email address:</label>
                            <input type="email" id="repEmail" name="repEmail">
                        </div>
                    </fieldset>
                    
                    
        
                    <!-- Purpose Section -->
                    <fieldset>
                        <legend>Other Purpose(s) of the Data Processing</legend>
        
                        <label for="subPurpose1">Sub-purpose 1:</label>
                        <input type="text" id="subPurpose1" name="subPurpose1">
        
                        <label for="subPurpose2">Sub-purpose 2:</label>
                        <input type="text" id="subPurpose2" name="subPurpose2">

                        <label for="subPurpose3">Sub-purpose 3:</label>
                        <input type="text" id="subPurpose3" name="subPurpose3">

                        <label for="subPurpose4">Sub-purpose 4:</label>
                        <input type="text" id="subPurpose4" name="subPurpose4">

                        <label for="subPurpose5">Sub-purpose 5:</label>
                        <input type="text" id="subPurpose5" name="subPurpose5">
        
                        <!-- Add additional sub-purpose fields as needed -->
                    </fieldset>

        
                    <!-- Categories of Personal Data Section -->
                    <fieldset>
                        <legend>Categories of Personal Data</legend>
                        <!-- Tabs -->
                        <div class="tabs">
                            <div class="tab-link" onclick="openTab('categoriesData')">Categories of Personal Data</div>
                            <div class="tab-link" onclick="openTab('specialCategoriesData')">Special Categories of Personal Data</div>
                        </div>

                        <!-- Tab Content -->
                        <div id="categoriesData" class="categories-tab-content">
                            <!-- Accordion for Categories of Personal Data -->
                            <div class="accordion">
                                <div class="accordion-button">Marital status, ID, identification data, images... &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description:</label>
                                    <input type="text" name="description_marital_status">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_marital_status">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Children's Data &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description:</label>
                                    <input type="text" name="description_children_data">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_children_data">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Personal life (lifestyle, family situation, etc.) &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description:</label>
                                    <input type="text" name="description_personal_life">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_personal_life">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Economic and financial information (income, financial situation, tax situation, etc.) &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description:</label>
                                    <input type="text" name="description_economic_financial">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_economic_financial">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Connection data (IP address, logs, etc.) &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description:</label>
                                    <input type="text" name="description_connection_data">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_connection_data">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Referees and other third parties &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description:</label>
                                    <input type="text" name="description_referees_third_parties">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_referees_third_parties">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Department to determine common categories of personal data &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description:</label>
                                    <input type="text" name="description_department_common_categories">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_department_common_categories">
                                </div>
                            </div>


                            <!-- Add more accordions as needed -->
                        </div>

                        <div id="specialCategoriesData" class="categories-tab-content">
                            <!-- Accordion for Special Categories of Personal Data -->
                            <div class="accordion">
                                <div class="accordion-button">Data revealing ethnic origin &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_ethnic_origin">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_ethnic_origin">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Data revealing health status &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_health_status">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_health_status">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Data revealing conscience, belief &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_conscience_belief">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_conscience_belief">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Data revealing ethnic social origin &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_ethnic_social_origin">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_ethnic_social_origin">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Genetic data &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_genetic_data">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_genetic_data">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Biometric data &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_biometric_data">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_biometric_data">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Data concerning property details &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_property_details">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_property_details">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Data revealing marital status &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_marital_status">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_marital_status">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Data revealing sex or the sexual orientation of the data subject &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_sex_orientation">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_sex_orientation">
                                </div>
                            </div>

                            <div class="accordion">
                                <div class="accordion-button">Data relating to family details including names of the person's children, parents, spouse or spouse &#10572;</div>
                                <div class="accordion-content">
                                    <label>Description/Context:</label>
                                    <input type="text" name="description_family_details">
                                    <label>Data retention period:</label>
                                    <input type="text" name="retention_period_family_details">
                                </div>
                            </div>


                            <!-- Add more accordions as needed -->
                        </div>
                    </fieldset>

        
                    <!-- Recipients Section -->
                    <fieldset>
                        <legend>Recipients</legend>
                        <label for="recipient1">Recipient 1:</label>
                        <input type="text" id="recipient1" name="recipient1">
        
                        <label for="recipientDetails1">Details:</label>
                        <textarea id="recipientDetails1" name="recipientDetails1"></textarea>
        
                        <!-- Add similar fields for other recipients -->
                    </fieldset>
        
                    <!-- Security Measures Section -->
                    <fieldset>
                        <legend>Security Measures</legend>
                        <label for="securityMeasure1">Type of security measure:</label>
                        <input type="text" id="securityMeasure1" name="securityMeasure1">
        
                        <label for="securityDetails1">Details:</label>
                        <textarea id="securityDetails1" name="securityDetails1"></textarea>
        
                        <!-- Add similar fields for other security measures -->
                    </fieldset>
        
                    <!-- Transfers to Third Countries Section -->
                    <fieldset>
                        <legend>Transfers to Third Countries or International Organisations</legend>
                        <label for="recipientOrg1">Recipient organisation 1:</label>
                        <input type="text" id="recipientOrg1" name="recipientOrg1">
        
                        <label for="recipientCountry1">Country:</label>
                        <input type="text" id="recipientCountry1" name="recipientCountry1">
        
                        <label for="typeOfGuarantees">Type of guarantees:</label>
                        <input type="text" id="typeOfGuarantees" name="typeOfGuarantees">
        
                        <label for="relevantDocuments">Links to relevant documents:</label>
                        <input type="url" id="relevantDocuments" name="relevantDocuments">
        
                        <!-- Add similar fields for other recipient organisations -->
                    </fieldset>
        
                    <!-- Submit and Close buttons -->
                    <div class="modal-footer">
                        <button type="submit">Save</button>
                        <button type="button" class="close-btn">Close</button>
                    </div>
                </form>
            </template>

            <script>
                //some vars
                let currentSegment = 0;
                const segments = document.querySelectorAll('.form-segment');
                const progress = document.querySelector('.progress');
                const prevBtn = document.querySelector('#prevBtn');
                const nextBtn = document.querySelector('#nextBtn');


                //show debug
                

                //CREATE OR READ EXSISTING DB
                const dbjs = require( 'database-js' );

                
                //REST OF IT
                
            
                function showSegment(n) {
                    // Hide the current segment
                    segments[currentSegment].classList.remove('active');
                    
                    // Move to the next/previous segment
                    currentSegment += n;
                    
                    // Check if the segment is out of bounds
                    if (currentSegment >= segments.length) {
                        currentSegment = segments.length - 1;
                    }
                    if (currentSegment < 0) {
                        currentSegment = 0;
                    }

                    // Show the new segment
                    segments[currentSegment].classList.add('active');

                    // Update buttons and progress
                    updateButtons();
                    updateProgress();

                    // If on the last segment and moving forward, submit the form
                    if (currentSegment === segments.length - 1 && n === 1) {
                        //document.getElementById("ropaForm").submit(); // Trigger the form submission
                    }
                }

            
                function changeSegment(n) {
                    showSegment(n);
                }
            
                function updateButtons() {
                    prevBtn.disabled = currentSegment === 0;
                    nextBtn.textContent = currentSegment >= (segments.length - 2) ? 'Submit' : 'Next';
                    currentSegment === (segments.length - 1) ? nextBtn.type = 'submit' : nextBtn.type = 'button';
                    currentSegment > (segments.length - 1) ? nextBtn.disabled = true : nextBtn.disabled = false;
                }
            
                function updateProgress() {
                    const percentComplete = ((currentSegment + 1) / segments.length) * 100;
                    progress.style.width = percentComplete + '%';
                }
            
                // Initial setup
                updateButtons();
                updateProgress();
                displayEntries();


            
                function showForm() {
                    document.querySelector('.container').style.display = 'block';
                    document.querySelector('.tableContainer').style.display = 'none';
                }
            
                function showTable() {
                    document.querySelector('.container').style.display = 'none';
                    document.querySelector('.tableContainer').style.display = 'block';
                    displayEntries();
                }
            
                // Store form data in localStorage (you can use a database in a real app)
                document.getElementById('ropaForm').onsubmit = function (e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    //const entries = JSON.parse(localStorage.getItem('entries')) || [];
                    const entry = {};
            
                    formData.forEach((value, key) => {
                        entry[key] = value;
                    });
                    //STORE TO DB
                    ( async () => {
                        let conn;
                        try {
                            conn = new dbjs.Connection( 'json:///ropa-base.json' );
                            const allEntries = conn.prepareStatement( 'SELECT *' );
                            const table = document.querySelector('#entriesTable');
                            const id = table.rows.length + 1;
                            const saveEntry = conn.prepareStatement( `INSERT VALUES {
                                "id":"${id}","automatedDecisionMaking":"${entry["automatedDecisionMaking"]}", "basisOfProcessing":"${entry["basisOfProcessing"]}", 
                                "data":"${entry["data"]}", "dataClassification":"${entry["dataClassification"]}", "dataSubject":"${entry["dataSubject"]}",
                                "gchControllerProcessor":"${entry["gchControllerProcessor"]}", "impactOfProcessing":"${entry["impactOfProcessing"]}", 
                                "justificationOfBasis":"${entry["justificationOfBasis"]}", "legitimateInterest":"${entry["legitimateInterest"]}",
                                "processingActivity":"${entry["processingActivity"]}", "purpose":"${entry["purpose"]}", "sensitiveData":"${entry["sensitiveData"]}", 
                                "sharedWith":"${entry["sharedWith"]}", "sourceReceivedFrom":"${entry["sourceReceivedFrom"]}",
                                "storage":"${entry["storage"]}", "storageDuration":"${entry["storageDuration"]}", "storageSecurity":"${entry["storageSecurity"]}", 
                                "thirdPartyControllerProcessor":"${entry["thirdPartyControllerProcessor"]}", "transfer":"${entry["transfer"]}", 
                                "transferMechanism":"${entry["transferMechanism"]}", "typeOfRecord":"${entry["typeOfRecord"]}"
                            }` );
                            await saveEntry.execute();
                        } catch(err) {
                            console.error( err );
                            alert(err);
                        } finally {
                            if ( conn ) {
                                await conn.close();
                            }
                            alert('Entry submitted successfully!');
                            displayEntries();
                        }
                    })();
            
                    //entries.push(entry);
            
                    //localStorage.setItem('entries', JSON.stringify(entries));
                    // alert('Form submitted successfully!');
                    this.reset();
                    showTable();
                    segments[currentSegment].classList.remove('active');
                    currentSegment = 0;  // Reset to first segment
                    showSegment(currentSegment);
                    updateButtons();  // Update navigation buttons
                    updateProgress();  // Reset progress bar
                };
            
                // Display entries in the table
                async function displayEntries() {
                    //const entries = JSON.parse(localStorage.getItem('entries')) || [];
                    let entries;
                    const tableName = 'ropa_entry';
                    
                    const tableBody = document.querySelector('#entriesTable tbody');
                    tableBody.innerHTML = '';

                    ( async () => {
                        let conn;
                        try {
                            conn = new dbjs.Connection( 'json:///ropa-base.json' );
                            const queryEntries = conn.prepareStatement( 'SELECT *' );
                            const entryData = await queryEntries.query();
                            entries = entryData;
                            // entries = JSON.parse(entries);

                        } catch (err) {
                            console.error( err );
                            alert(err);
                        } finally {
                            if ( conn ) {
                                await conn.close();
                            }
                            drawEntries();
                            hideColumns();
                        }
                    })();

                    //new entry mechanism
                    function drawEntries(){
                        entries.forEach((entry) => {
                            console.log(entry);
                            const row = document.createElement('tr');

                            // Badge Cell
                            const badgeCell = document.createElement('td');
                            const sensitivityBadgeClass = entry["sensitiveData"] === 'yes' ? 'sensitive-badge' : 'non-sensitive-badge';
                            const securityBadgeClass = entry["storageSecurity"] == 0 ? 'sensitive-badge' : entry["storageSecurity"] == 1 ? 'neutral-badge' : entry["storageSecurity"] == 2 ? 'non-sensitive-badge' : 'no-badge'
                            badgeCell.innerHTML = `<div class="${sensitivityBadgeClass}">${entry["sensitiveData"] === 'yes' ? 'Sensitive' : 'Non-Sensitive'}</div>
                                                <div class="${securityBadgeClass}">${entry["storageSecurity"] == 0 ? 'Unsafe' : entry["storageSecurity"] == 1 ? 'Safe' : entry["storageSecurity"] == 2 ? 'Protected' : 'Undefined'}</div>`;

                            // Info Cell
                            const infoCell = document.createElement('td');
                            infoCell.classList.add('info-cell');
                            infoCell.innerHTML = `
                                <div><span class="legend">Source:</span> <span class="data">${entry["sourceReceivedFrom"]}</span></div> 
                                <div><span class="legend">Data:</span> <span class="data">${entry["data"]}</span></div> 
                                <div><span class="legend">Processing Activity:</span> <span class="data">${entry["processingActivity"]}</span></div>
                            `;

                            // Parties Cell
                            const partiesCell = document.createElement('td');
                            partiesCell.classList.add('parties-cell');
                            partiesCell.innerHTML = `
                                <div><span class="legend">Data Subject:</span> <span class="data">${entry["dataSubject"]}</span></div>
                                <div><span class="legend">Purpose:</span> <span class="data">${entry["purpose"]}</span></div>
                                <div><span class="legend">Shared With:</span> <span class="data">${entry["sharedWith"]}</span></div>
                            `;

                            // Controller Processor Cell
                            const controllerProcessorCell = document.createElement('td');
                            controllerProcessorCell.classList.add('controller-processor-cell');
                            controllerProcessorCell.innerHTML = `
                                <div><span class="legend">GCH:</span> <span class="data">${entry["gchControllerProcessor"]}</span></div>
                                <div><span class="legend">Third Party:</span> <span class="data">${entry["thirdPartyControllerProcessor"]}</span></div>
                                <div><span class="legend">Basis of Processing:</span> <span class="data">${entry["basisOfProcessing"]}</span></div>
                                <div><span class="legend">Justification of Basis:</span> <span class="data">${entry["justificationOfBasis"]}</span></div>
                                <div><span class="legend">Auto Decision Making:</span> <span class="data">${entry["automatedDecisionMaking"]}</span></div>
                            `;

                            // Protection Cell
                            const protectionCell = document.createElement('td');
                            protectionCell.classList.add('protection-cell');
                            protectionCell.innerHTML = `
                                <div><span class="legend">Storage:</span> <span class="data">${entry["storage"]}</span></div>
                                <div><span class="legend">Duration:</span> <span class="data">${entry["storageDuration"]}</span></div>
                                <div><span class="legend">Transfer:</span> <span class="data">${entry["transfer"]}</span></div>
                                <div><span class="legend">Transfer Mechanism:</span> <span class="data">${entry["transferMechanism"]}</span></div>
                            `;

                            row.appendChild(badgeCell);
                            row.appendChild(infoCell);
                            row.appendChild(partiesCell);
                            row.appendChild(controllerProcessorCell);
                            row.appendChild(protectionCell);

                            tableBody.appendChild(row);

                        });
                    }

                    
                }
                // Function to hide specific columns based on the index
                function hideColumns() {
                    var table = document.getElementById("entriesTable");
                    var hideIndices = [];

                    // Find the indices of the columns that should be hidden
                    var headerCells = table.rows[0].cells;
                    for (var i = 0; i < headerCells.length; i++) {
                    if (headerCells[i].classList.contains("hide-column")) {
                        hideIndices.push(i);
                    }
                    }

                    // Hide the header columns
                    for (var i = 0; i < hideIndices.length; i++) {
                    headerCells[hideIndices[i]].style.display = "none";
                    }

                    // Hide the corresponding columns in the body rows
                    for (var j = 1; j < table.rows.length; j++) { // Start from 1 to skip the header row
                    for (var k = 0; k < hideIndices.length; k++) {
                        table.rows[j].cells[hideIndices[k]].style.display = "none";
                    }
                    }
                }


                // Get modal and close button elements
                const modal = document.getElementById("ropaModal");
                const modalForm = document.getElementById("ropaModalTemplate");
                const closeBtn = document.querySelector(".close");

                // Function to open the modal and populate it with data
                function openModal(entryData) {
                    const modalBody = document.getElementById("modalBody");
                    // Clear previous content
                    modalBody.innerHTML = "";
                    
                    
                    // Populate modal with entry data
                    modalBody.innerHTML += `<p>Info: ${entryData.info}</p>`;
                    modalBody.innerHTML += `<p>Parties Involved: ${entryData.parties}</p>`;
                    // Add other data fields as needed
                    const templateContent = modalForm.content.cloneNode(true);// Clone the template content
                    modalBody.appendChild(templateContent);// Append the cloned content to the modal body
                    openTab('categoriesData');
                    initializeAccordions();

                    // Display the modal
                    modal.style.display = "block";
                }

                // Event listener for table rows
                document.getElementById("entriesTable").addEventListener("click", function (event) {
                let targetElement = event.target;

                // Traverse up the DOM tree to find the <td> element, if necessary
                while (targetElement && targetElement.nodeName !== "TD") {
                    targetElement = targetElement.parentNode;
                }

                if (targetElement) {
                    const row = targetElement.parentNode; // <tr> element
                    const entryData = {
                        info: row.children[1].innerHTML,
                        parties: row.children[2].innerHTML
                        // Add other data fields as needed
                    };
                    openModal(entryData);
                }
            });


                // Event listener for the close button
                closeBtn.onclick = function () {
                    modal.style.display = "none";
                }

                // Close the modal if the user clicks anywhere outside of the modal
                window.onclick = function (event) {
                    if (event.target === modal) {
                        modal.style.display = "none";
                    }
                }

                function openStakeholderTab(event, stakeholderId) {
                    // Hide all tab contents
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(tab => tab.classList.remove('active'));

                    // Remove active class from all tabs
                    const tabLinks = document.querySelectorAll('.tab-link');
                    tabLinks.forEach(tab => tab.classList.remove('active'));

                    // Show the current tab content
                    document.getElementById(stakeholderId).classList.add('active');

                    // Add active class to the clicked tab
                    event.currentTarget.classList.add('active');
                }

                function openTab(tabName) {
                    var i, tabcontent, tabbuttons;
                    tabcontent = document.getElementsByClassName("categories-tab-content");
                    for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                    }
                    tabbuttons = document.getElementsByClassName("tab-button");
                    for (i = 0; i < tabbuttons.length; i++) {
                    tabbuttons[i].className = tabbuttons[i].classList.remove('active');
                    }
                    document.getElementById(tabName).style.display = "block";
                    event.currentTarget.classList.add("active");
                }



                modal.addEventListener("shown.bs.modal", function () {
                    console.log("Modal opened");
                    
                });

                function initializeAccordions() {
                    const accordionButtons = document.querySelectorAll('.accordion-button');
                    accordionButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const accordionContent = this.nextElementSibling;
                            if (accordionContent.style.display === 'block') {
                                accordionContent.style.display = 'none';
                            } else {
                                accordionContent.style.display = 'block';
                            }
                        });
                    });
                }


             

            </script>
            
        </main>
    </div>
</body>
</html>
